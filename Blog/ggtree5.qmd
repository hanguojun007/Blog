---
title: "ggtree5"
author: "大番薯本薯"
date: "2026-01-23"
date-modified: "2026-01-23"
draft: false
categories: [ggtree]

format:
  html:
    code-link: true

fig-width: 6
fig-asp: 0.618
out-width: 70%
fig-align: center

knitr:
  opts_chunk:
    collapse: true
    comment: "#>"
    R.options:
      dplyr.print_min: 6
      dplyr.print_max: 6
      pillar.max_footer_lines: 2
      pillar.min_chars: 15
      stringr.view_n: 6
      cli.num_colors: 0
      cli.hyperlink: FALSE
      pillar.bold: TRUE
      width: 77

execute:
  warning: true
  error: true
---

本节是对前四节的补充，它们大多是一些通用的函数。

-   `%<+%`：类似于`full_join()`，但是直接在ggplot对象中添加新的数据
-   `hexpand()`, `vexpand()`：延长树图的宽度和高度
-   `get_taxa_name()`：获取ggplot图中taxa的顺序和名称
-   `label_pad()`：设置label的间隔
-   `identify()`：获取ggplot对象中的数据


加载一颗基本树

```{r}
library(treeio)
library(ggtree)
# library(ggimage)

nwk <- system.file("extdata", "sample.nwk", package = "treeio")
tree <- treeio::read.tree(nwk)
tree$node.label <- c("root", paste("node", 2:treeio::Nnode(tree)))
p <- ggtree(tree)
```

## `%<+%`

`%<+%` 固定使用数据第一列与`p$data`中的label列进行匹配。

```{r}
fortify(tree)
d <- data.frame(tip = LETTERS[1:13], value = 1:treeio::Ntip(tree))
(p %<+% d)$data
```

## `hexpand()`, `vexpand()`

`text`的长度在ggplot中不被考虑，很多时候文本注释信息会在图中显示不全被截断。

当使用`coord_cartesian(clip = "off")`时，超出边界的文本不会被裁剪，但仍然可能仍然无法显示。需要将`x`，`y`轴延展。

```{r}
tree2 <- tree
tree2$tip.label <- paste0('to make the label longer_', tree2$tip.label)
ggtree::ggtree(tree2) + geom_tiplab() + hexpand(.4)
```

## `get_taxa_name()`

获取taxa名称，顺序以树图中展示的为准。

```{r}
get_taxa_name(p)
get_taxa_name(p, node = "node 12")
```

## `label_pad()`

用来将label对齐，不足的部分使用某个字符填充。

```{r}
chr <- c("a", "b", "cccccccc")
tibble::tibble(
  label = chr,
  label_pad = label_pad(label, pad = "."),
  label_pad_2 = label_pad(label, justify = "left", pad = ".")
)
```

## `identify()`

使用`identify()`函数，可以手动选择注释clade或tip（可能需要使用Rstudio）。
