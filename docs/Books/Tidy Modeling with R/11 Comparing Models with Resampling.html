<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="dcterms.date" content="2025-10-20">
<title>11 Comparing Models with Resampling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../Books/Tidy Modeling with R/12 Model Tuning and the Dangers of Overfitting.html" rel="next">
<link href="../../Books/Tidy Modeling with R/10 Resampling for Evaluating Performance.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-2bc269ba33bfe0c9779ec90686b7c52e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": true,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "Search",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script><link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script><link rel="stylesheet" href="../../styles.css">
</head>
<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">RSSPtho</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link active" href="../../index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-books" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Books</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-books">
<li>
    <a class="dropdown-item" href="../../Books/ggplot2/index.html">
 <span class="dropdown-text">ggplot2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Books/R4DS2/index.html">
 <span class="dropdown-text">R for Data Science(2e)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Books/Tidy Modeling with R/index.html">
 <span class="dropdown-text">Tidy Modeling with R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Books/Advanced R(2e)/index.html">
 <span class="dropdown-text">Advanced R(2e)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Books/quarto/Project Basics.html">
 <span class="dropdown-text">Quarto</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Books/Js4R/00 Preface.qmd">
 <span class="dropdown-text">Js4R</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About me</span></a>
  </li>  
</ul>
<div class="quarto-navbar-tools">
    <a href="https://github.com/hanguojun007/Blog" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../Books/Tidy Modeling with R/11 Comparing Models with Resampling.html">11 Comparing Models with Resampling</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../../index.html" class="sidebar-logo-link">
      </a>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Books/Tidy Modeling with R/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hello World</span></a>
  </div>
</li>
        <li class="sidebar-item">
 <span class="menu-text">Introduction</span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Books/Tidy Modeling with R/1 Software for modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1 Software for modeling</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Books/Tidy Modeling with R/2 A Tidyverse Primer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2 A Tidyverse Primer</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Books/Tidy Modeling with R/3 A Review of R Modeling Fundamentals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3 A Review of R Modeling Fundamentals</span></a>
  </div>
</li>
        <li class="sidebar-item">
 <span class="menu-text">Moduling Basics</span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Books/Tidy Modeling with R/4 The Ames Housing Data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4 The Ames Housing Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Books/Tidy Modeling with R/5 Spending our Data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5 Spending our Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Books/Tidy Modeling with R/6 Fitting Models with parsnip.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6 Fitting Models with parsnip</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Books/Tidy Modeling with R/7 A Model Workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7 A Model Workflow</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Books/Tidy Modeling with R/8 Feature Engineering with recipes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8 Feature Engineering with recipes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Books/Tidy Modeling with R/9 Judging Model Effectiveness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9 Judging Model Effectiveness</span></a>
  </div>
</li>
        <li class="sidebar-item">
 <span class="menu-text">Tools For Creating Effective Models</span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Books/Tidy Modeling with R/10 Resampling for Evaluating Performance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10 Resampling for Evaluating Performance</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Books/Tidy Modeling with R/11 Comparing Models with Resampling.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">11 Comparing Models with Resampling</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Books/Tidy Modeling with R/12 Model Tuning and the Dangers of Overfitting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12 Model Tuning and the Dangers of Overfitting</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#creating-multiple-models-with-workflow-sets" id="toc-creating-multiple-models-with-workflow-sets" class="nav-link active" data-scroll-target="#creating-multiple-models-with-workflow-sets">Creating Multiple Models with Workflow Sets</a></li>
  <li><a href="#comparing-resampled-performance-statistics" id="toc-comparing-resampled-performance-statistics" class="nav-link" data-scroll-target="#comparing-resampled-performance-statistics">Comparing Resampled Performance Statistics</a></li>
  <li><a href="#simple-hypothesis-testing-methods" id="toc-simple-hypothesis-testing-methods" class="nav-link" data-scroll-target="#simple-hypothesis-testing-methods">Simple Hypothesis Testing Methods</a></li>
  <li>
<a href="#bayesian-methods" id="toc-bayesian-methods" class="nav-link" data-scroll-target="#bayesian-methods">Bayesian Methods</a>
  <ul class="collapse">
<li><a href="#a-random-intercept-model" id="toc-a-random-intercept-model" class="nav-link" data-scroll-target="#a-random-intercept-model">A random intercept model</a></li>
  <li><a href="#the-effect-of-the-amount-of-resampling" id="toc-the-effect-of-the-amount-of-resampling" class="nav-link" data-scroll-target="#the-effect-of-the-amount-of-resampling">The effect of the amount of resampling</a></li>
  </ul>
</li>
  <li><a href="#chapter-summary" id="toc-chapter-summary" class="nav-link" data-scroll-target="#chapter-summary">Chapter Summary</a></li>
  </ul></nav>
    <div class="quarto-margin-footer"><div class="margin-footer-item">
<p><img src="../..\logo.jpg" class="conditional-footer img-fluid" width="200"></p>
</div></div></div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">11 Comparing Models with Resampling</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 20, 2025</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">October 20, 2025</p>
    </div>
  </div>
    
  </div>
  


</header><p>一旦我们创建了两个或更多模型，下一步就是对它们进行比较，以了解哪个模型最好。在某些情况下，“比较”可能在<strong>模型内</strong>进行——使用不同的特征或预处理方法对同一个模型进行评估。另外，<strong>模型间</strong>的比较更为常见，比如我们在第10章中对线性回归模型和随机森林模型进行的比较。</p>
<p>无论是哪种情况，结果都是每个模型的一组重采样汇总统计量（例如，均方根误差、准确率等）。在本章中，我们首先演示如何使用工作流集来拟合多个模型。然后，我们讨论重采样统计量的重要方面。最后，我们探讨如何规范地比较模型（使用假设检验或贝叶斯方法）。</p>
<section id="creating-multiple-models-with-workflow-sets" class="level2"><h2 class="anchored" data-anchor-id="creating-multiple-models-with-workflow-sets">Creating Multiple Models with Workflow Sets</h2>
<p>在第7.5节中，我们介绍了工作流集合的概念，即可以组合生成不同的预处理器和/或模型。在第10章，我们使用了针对Ames数据的recipe对象——包含了一个交互项，以及用于经度和纬度的样条函数。为了更深入地展示工作流集合的应用，让我们依次逐步添加这些预处理步骤，创建三个不同的线性模型，随后检验这些新增项是否能提升模型的表现。</p>
<p>首先，创建三个recipe对象，再将它们整合进一个工作流集合中：</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ── Attaching packages ─────────────────────────────────── tidymodels 1.4.1 ──</span></span>
<span><span class="co">#&gt; ✔ broom        1.0.9     ✔ recipes      1.3.1</span></span>
<span><span class="co">#&gt; ✔ dials        1.4.2     ✔ rsample      1.3.1</span></span>
<span><span class="co">#&gt; ✔ dplyr        1.1.4     ✔ tailor       0.1.0</span></span>
<span><span class="co">#&gt; ✔ ggplot2      3.5.2     ✔ tidyr        1.3.1</span></span>
<span><span class="co">#&gt; ✔ infer        1.0.9     ✔ tune         2.0.0</span></span>
<span><span class="co">#&gt; ✔ modeldata    1.5.1     ✔ workflows    1.3.0</span></span>
<span><span class="co">#&gt; ✔ parsnip      1.3.3     ✔ workflowsets 1.1.1</span></span>
<span><span class="co">#&gt; ✔ purrr        1.1.0     ✔ yardstick    1.3.2</span></span>
<span><span class="co">#&gt; ── Conflicts ────────────────────────────────────── tidymodels_conflicts() ──</span></span>
<span><span class="co">#&gt; ✖ purrr::discard() masks scales::discard()</span></span>
<span><span class="co">#&gt; ✖ dplyr::filter()  masks stats::filter()</span></span>
<span><span class="co">#&gt; ✖ dplyr::lag()     masks stats::lag()</span></span>
<span><span class="co">#&gt; ✖ recipes::step()  masks stats::step()</span></span>
<span><span class="fu"><a href="https://tidymodels.tidymodels.org/reference/tidymodels_prefer.html">tidymodels_prefer</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">ames</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span><span class="va">ames</span>, Sale_Price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">Sale_Price</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">502</span><span class="op">)</span></span>
<span><span class="va">ames_split</span> <span class="op">&lt;-</span> <span class="fu">initial_split</span><span class="op">(</span><span class="va">ames</span>, prop <span class="op">=</span> <span class="fl">0.80</span>, strata <span class="op">=</span> <span class="va">Sale_Price</span><span class="op">)</span></span>
<span><span class="va">ames_train</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">ames_split</span><span class="op">)</span></span>
<span><span class="va">ames_test</span> <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">ames_split</span><span class="op">)</span></span>
<span></span>
<span><span class="va">basic_rec</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">recipe</span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">Neighborhood</span> <span class="op">+</span> <span class="va">Gr_Liv_Area</span> <span class="op">+</span> <span class="va">Year_Built</span> <span class="op">+</span> <span class="va">Bldg_Type</span> <span class="op">+</span></span>
<span>    <span class="va">Latitude</span> <span class="op">+</span> <span class="va">Longitude</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">step_log</span><span class="op">(</span><span class="va">Gr_Liv_Area</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">step_other</span><span class="op">(</span><span class="va">Neighborhood</span>, threshold <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">step_dummy</span><span class="op">(</span><span class="fu">all_nominal_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">interaction_rec</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">basic_rec</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">step_interact</span><span class="op">(</span><span class="op">~</span> <span class="va">Gr_Liv_Area</span><span class="op">:</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"Bldg_Type_"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">spline_rec</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">interaction_rec</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">step_ns</span><span class="op">(</span><span class="va">Latitude</span>, <span class="va">Longitude</span>, deg_free <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span><span class="va">preproc</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    basic <span class="op">=</span> <span class="va">basic_rec</span>,</span>
<span>    interact <span class="op">=</span> <span class="va">interaction_rec</span>,</span>
<span>    splines <span class="op">=</span> <span class="va">spline_rec</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">lm_models</span> <span class="op">&lt;-</span> <span class="fu">workflow_set</span><span class="op">(</span><span class="va">preproc</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>lm <span class="op">=</span> <span class="fu">linear_reg</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, cross <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">lm_models</span></span>
<span><span class="co">#&gt; # A workflow set/tibble: 3 × 4</span></span>
<span><span class="co">#&gt;   wflow_id    info             option    result    </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;list&gt;           &lt;list&gt;    &lt;list&gt;    </span></span>
<span><span class="co">#&gt; 1 basic_lm    &lt;tibble [1 × 4]&gt; &lt;opts[0]&gt; &lt;list [0]&gt;</span></span>
<span><span class="co">#&gt; 2 interact_lm &lt;tibble [1 × 4]&gt; &lt;opts[0]&gt; &lt;list [0]&gt;</span></span>
<span><span class="co">#&gt; 3 splines_lm  &lt;tibble [1 × 4]&gt; &lt;opts[0]&gt; &lt;list [0]&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>我们希望依次对这些模型进行重新采样。为此，我们将使用一个<strong>purrr-like</strong>函数，名为<code>workflow_map()</code>。该函数首先接受一个要应用于工作流的函数作为初始参数，随后是该函数的相关选项。此外，我们还设置了<code>verbose</code>参数，用于打印进度信息；以及<code>seed</code>参数，确保每种模型都使用与其他模型相同的随机数种子。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_folds</span> <span class="op">&lt;-</span> <span class="fu">vfold_cv</span><span class="op">(</span><span class="va">ames_train</span>, v <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">keep_pred</span> <span class="op">&lt;-</span> <span class="fu">control_resamples</span><span class="op">(</span>save_pred <span class="op">=</span> <span class="cn">TRUE</span>, save_workflow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lm_models</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">lm_models</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">workflow_map</span><span class="op">(</span><span class="st">"fit_resamples"</span>,</span>
<span>    <span class="co"># Options to `workflow_map()`:</span></span>
<span>    seed <span class="op">=</span> <span class="fl">1101</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    <span class="co"># Options to `fit_resamples()`:</span></span>
<span>    resamples <span class="op">=</span> <span class="va">ames_folds</span>, control <span class="op">=</span> <span class="va">keep_pred</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; i 1 of 3 resampling: basic_lm</span></span>
<span><span class="co">#&gt; ✔ 1 of 3 resampling: basic_lm (3.6s)</span></span>
<span><span class="co">#&gt; i 2 of 3 resampling: interact_lm</span></span>
<span><span class="co">#&gt; ✔ 2 of 3 resampling: interact_lm (3.7s)</span></span>
<span><span class="co">#&gt; i 3 of 3 resampling: splines_lm</span></span>
<span><span class="co">#&gt; ✔ 3 of 3 resampling: splines_lm (5.8s)</span></span>
<span><span class="va">lm_models</span></span>
<span><span class="co">#&gt; # A workflow set/tibble: 3 × 4</span></span>
<span><span class="co">#&gt;   wflow_id    info             option    result   </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;list&gt;           &lt;list&gt;    &lt;list&gt;   </span></span>
<span><span class="co">#&gt; 1 basic_lm    &lt;tibble [1 × 4]&gt; &lt;opts[2]&gt; &lt;rsmp[+]&gt;</span></span>
<span><span class="co">#&gt; 2 interact_lm &lt;tibble [1 × 4]&gt; &lt;opts[2]&gt; &lt;rsmp[+]&gt;</span></span>
<span><span class="co">#&gt; 3 splines_lm  &lt;tibble [1 × 4]&gt; &lt;opts[2]&gt; &lt;rsmp[+]&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>请注意，<code>option</code>列和<code>result</code>列现已填满内容。前者包含了之前提供的<code>fit_resamples()</code>函数的选项（以确保可重复性），而后者则列出了由<code>fit_resamples()</code>生成的结果。</p>
<p>有一些适用于工作流集合的便捷函数，包括用于汇总性能统计信息的<code>collect_metrics()</code>。我们还可以使用<code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code>来筛选出感兴趣的特定指标：</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">collect_metrics</span><span class="op">(</span><span class="va">lm_models</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">.metric</span> <span class="op">==</span> <span class="st">"rmse"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 9</span></span>
<span><span class="co">#&gt;   wflow_id    .config         preproc model      .metric .estimator   mean</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;           &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 basic_lm    pre0_mod0_post0 recipe  linear_reg rmse    standard   0.0800</span></span>
<span><span class="co">#&gt; 2 interact_lm pre0_mod0_post0 recipe  linear_reg rmse    standard   0.0796</span></span>
<span><span class="co">#&gt; 3 splines_lm  pre0_mod0_post0 recipe  linear_reg rmse    standard   0.0786</span></span>
<span><span class="co">#&gt; # ℹ 2 more variables: n &lt;int&gt;, std_err &lt;dbl&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>上一章中的随机森林模型呢？我们可以先将其转换为独立的工作流集，然后再绑定行，从而将其加入到集合中。需要注意的是，当对该模型进行重采样时，必须在<code>control_resamples()</code>函数中设置<code>save_workflow = TRUE</code>。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rf_model</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">rand_forest</span><span class="op">(</span>trees <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"ranger"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"regression"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rf_wflow</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">add_formula</span><span class="op">(</span></span>
<span>    <span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">Neighborhood</span> <span class="op">+</span> <span class="va">Gr_Liv_Area</span> <span class="op">+</span> <span class="va">Year_Built</span> <span class="op">+</span> <span class="va">Bldg_Type</span> <span class="op">+</span></span>
<span>      <span class="va">Latitude</span> <span class="op">+</span> <span class="va">Longitude</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">rf_model</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rf_res</span> <span class="op">&lt;-</span> <span class="va">rf_wflow</span> <span class="op">%&gt;%</span> <span class="fu">fit_resamples</span><span class="op">(</span>resamples <span class="op">=</span> <span class="va">ames_folds</span>, control <span class="op">=</span> <span class="va">keep_pred</span><span class="op">)</span></span>
<span></span>
<span><span class="va">four_models</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">as_workflow_set</span><span class="op">(</span>random_forest <span class="op">=</span> <span class="va">rf_res</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">bind_rows</span><span class="op">(</span><span class="va">lm_models</span><span class="op">)</span></span>
<span><span class="va">four_models</span></span>
<span><span class="co">#&gt; # A workflow set/tibble: 4 × 4</span></span>
<span><span class="co">#&gt;   wflow_id      info             option    result   </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;         &lt;list&gt;           &lt;list&gt;    &lt;list&gt;   </span></span>
<span><span class="co">#&gt; 1 random_forest &lt;tibble [1 × 4]&gt; &lt;opts[0]&gt; &lt;rsmp[+]&gt;</span></span>
<span><span class="co">#&gt; 2 basic_lm      &lt;tibble [1 × 4]&gt; &lt;opts[2]&gt; &lt;rsmp[+]&gt;</span></span>
<span><span class="co">#&gt; 3 interact_lm   &lt;tibble [1 × 4]&gt; &lt;opts[2]&gt; &lt;rsmp[+]&gt;</span></span>
<span><span class="co">#&gt; 4 splines_lm    &lt;tibble [1 × 4]&gt; &lt;opts[2]&gt; &lt;rsmp[+]&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code>方法的输出如 <a href="#fig-11.1" class="quarto-xref">Figure&nbsp;1</a> 所示，它按模型从优到劣的顺序展示了各模型的置信区间。在本章中，我们将重点关注决定系数（又称<span class="math inline">\(R^2\)</span>），并在调用时使用参数<code>metric = "rsq"</code>来设置我们的图表：</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggrepel.slowkow.com/">ggrepel</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">four_models</span>, metric <span class="op">=</span> <span class="st">"rsq"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">wflow_id</span><span class="op">)</span>, nudge_x <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">8</span>, nudge_y <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-11.1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-11.1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="11-Comparing-Models-with-Resampling_files/figure-html/fig-11.1-1.png" class="img-fluid figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-11.1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Confidence intervals for the coefficient of determination using four different models
</figcaption></figure>
</div>
</div>
</div>
<p>从这一组<span class="math inline">\(R^2\)</span>置信区间图中，我们可以看出随机森林方法表现最佳，而随着我们逐步增加配方步骤，线性模型也呈现出微小的改进。</p>
<p>现在，我们已为四个模型中的每一个模型获得了10个重新采样的性能估计值，这些汇总统计量可用于进行模型间的比较。</p>
</section><section id="comparing-resampled-performance-statistics" class="level2"><h2 class="anchored" data-anchor-id="comparing-resampled-performance-statistics">Comparing Resampled Performance Statistics</h2>
<p>上述三种线性模型的结果似乎表明，新增的项并未显著改善线性模型的平均RMSE或<span class="math inline">\(R^2\)</span>统计量。尽管差异较小，但可能已超出系统中的实验噪声范围，即在统计上具有显著性意义。我们可以进行正式的检验假设来说明：新增项确实提高了<span class="math inline">\(R^2\)</span>值。</p>
<p>在进行模型间比较之前，我们有必要先讨论一下重采样统计量的样本内相关性。每个模型都使用相同的重采样数据集进行评估，这通往往会导致重采样的结果较为接近。换句话说，有些重采样情况下，各模型的表现往往较低；而在另一些重采样情况下，则倾向于较高。在统计学中，这被称为<strong>重采样间（resample-to-resample）的变异成分</strong>。</p>
<p>举例来说，让我们汇总线性模型和随机森林的各个重采样统计量。我们将重点关注每个模型的<span class="math inline">\(R^2\)</span>统计量，该统计量用于衡量每栋房屋的实际销售价格与预测销售价格之间的相关性。接下来，我们通过<code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code>函数仅保留这些<span class="math inline">\(R^2\)</span>指标，然后重塑结果，并计算这些指标彼此之间的相关性。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rsq_indiv_estimates</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">collect_metrics</span><span class="op">(</span><span class="va">four_models</span>, summarize <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">.metric</span> <span class="op">==</span> <span class="st">"rsq"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rsq_wider</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">rsq_indiv_estimates</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">wflow_id</span>, <span class="va">.estimate</span>, <span class="va">id</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>id_cols <span class="op">=</span> <span class="st">"id"</span>, names_from <span class="op">=</span> <span class="st">"wflow_id"</span>, values_from <span class="op">=</span> <span class="st">".estimate"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">corrr</span><span class="fu">::</span><span class="fu"><a href="https://corrr.tidymodels.org/reference/correlate.html">correlate</a></span><span class="op">(</span><span class="va">rsq_wider</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">id</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 5</span></span>
<span><span class="co">#&gt;   term          random_forest basic_lm interact_lm splines_lm</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                 &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 random_forest        NA        0.929       0.922      0.879</span></span>
<span><span class="co">#&gt; 2 basic_lm              0.929   NA           0.996      0.943</span></span>
<span><span class="co">#&gt; 3 interact_lm           0.922    0.996      NA          0.956</span></span>
<span><span class="co">#&gt; 4 splines_lm            0.879    0.943       0.956     NA</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>结果表明在不同模型之间，每次重采样内的相关性很大。为了更直观地体现这一点，每个模型的<span class="math inline">\(R^2\)</span>统计量都以连线的方式标注了各次重采样的结果，如 <a href="#fig-11.2" class="quarto-xref">Figure&nbsp;2</a> 所示：</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rsq_indiv_estimates</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>wflow_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">wflow_id</span>, <span class="va">.estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">wflow_id</span>, y <span class="op">=</span> <span class="va">.estimate</span>, group <span class="op">=</span> <span class="va">id</span>, color <span class="op">=</span> <span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># ggplot(aes(x = id, y = .estimate, group = wflow_id, color = wflow_id)) +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.5</span>, linewidth <span class="op">=</span> <span class="fl">1.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-11.2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-11.2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="11-Comparing-Models-with-Resampling_files/figure-html/fig-11.2-1.png" class="img-fluid figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-11.2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Resample statistics across models
</figcaption></figure>
</div>
</div>
</div>
<p>如果重采样间的效应不存在，就不会出现任何平行趋势。存在一种用于检验相关性的统计方法，旨在评估这些相关性的大小是否仅仅是随机噪声。对于线性模型而言：</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rsq_wider</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html">cor.test</a></span><span class="op">(</span><span class="va">basic_lm</span>, <span class="va">splines_lm</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">estimate</span>, <span class="fu">starts_with</span><span class="op">(</span><span class="st">"conf"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span><span class="co">#&gt;   estimate conf.low conf.high</span></span>
<span><span class="co">#&gt;      &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1    0.943    0.772     0.987</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>相关性检验的结果<code>estimate</code>列（相关性估计值及置信区间）表明，样本内相关性似乎确实存在。</p>
<p>额外的相关性对我们的分析有何影响？请考虑两个变量之差的方差：</p>
<p><span class="math display">\[
\operatorname{Var}[X - Y] = \operatorname{Var}[X] + \operatorname{Var}[Y]  - 2 \operatorname{Cov}[X, Y]
\]</span></p>
<p>最后的项是两个变量之间的协方差。如果存在显著的正协方差，那么在比较两个模型差异时，任何针对这一差异的统计检验都将严重缺乏检验力。换句话说，忽略重采样间的效应，可能会导致我们的模型比较倾向于得出“模型间无明显差异”的结论。这种重采样统计的特性将在接下来的两个小节中详细讨论。</p>
<p>在进行模型比较或查看重采样结果之前，我们需要明确一个相关的<strong>实际效应大小</strong>。例如，上述这些分析聚焦于<span class="math inline">\(R^2\)</span>统计量，因此实际效应大小即为我们认为具有实际意义且值得关注的<span class="math inline">\(R^2\)</span>值变化幅度。例如，我们可能认为，如果两个模型的<span class="math inline">\(R^2\)</span>值相差不超过<span class="math inline">\(\pm 2\)</span>%，则它们在实际意义上并无差异。换言之，即使差异在统计上显著，若小于2%，我们也视其为不具重要性。</p>
<p>实践意义是主观的；两个人对重要性的阈值可能有着截然不同的看法。不过，我们稍后会说明，在模型选择过程中，这一考量实际上非常有帮助。</p>
</section><section id="simple-hypothesis-testing-methods" class="level2"><h2 class="anchored" data-anchor-id="simple-hypothesis-testing-methods">Simple Hypothesis Testing Methods</h2>
<p>我们可以使用简单的假设检验来对模型进行正式比较。考虑熟悉的线性统计模型：</p>
<p><span class="math display">\[
y_{ij} = \beta_0 + \beta_1x_{i1} + \ldots + \beta_px_{ip} + \epsilon_{ij}
\]</span></p>
<p>这种多功能模型既可用于构建回归模型，也是广泛应用的方差分析（ANOVA）技术中比较各组差异的基础。在ANOVA模型中，预测变量（<span class="math inline">\(x_{ij}\)</span>）是用于区分不同组别的二元虚拟变量。通过这些变量，<span class="math inline">\(\beta\)</span>参数能够借助假设检验方法，判断两个或多个组之间是否存在显著差异。在我们具体的情境中，ANOVA同样可以用于模型比较。</p>
<p>假设每个重新抽样的<span class="math inline">\(R^2\)</span>统计量作为因变量数据（即<span class="math inline">\(y_{ij}\)</span>），而各模型则作为ANOVA模型中的预测变量。这种数据结构的示例见 <a href="#tbl-11.1" class="quarto-xref">Table&nbsp;1</a> 。</p>
<div id="tbl-11.1" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-11.1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Model performance statistics as a data set for analysis.
</figcaption><div aria-describedby="tbl-11.1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table cell caption-top table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Y = rsq</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">model</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">X1</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">X2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">X3</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">id</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.8441590</td>
<td style="text-align: left;">basic_lm</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Fold01</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.8441893</td>
<td style="text-align: left;">interact_lm</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Fold01</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.8717934</td>
<td style="text-align: left;">random_forest</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Fold01</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.8378595</td>
<td style="text-align: left;">splines_lm</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Fold01</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.7903836</td>
<td style="text-align: left;">basic_lm</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Fold02</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.7974093</td>
<td style="text-align: left;">interact_lm</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Fold02</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>表格中的<code>X1</code>、<code>X2</code>和<code>X3</code>列是<code>model</code>列中数值的指示器。它们的排列顺序与R语言定义这些列的方式相同，即按<code>model</code>列中名称的字母顺序排列。</p>
<p>在我们的模型比较中，具体的方差分析模型是：</p>
<p><span class="math display">\[
y_{ij} = \beta_0 + \beta_1x_{i1} + \beta_2x_{i2} + \beta_3x_{i3} + \epsilon_{ij}
\]</span></p>
<p>其中：</p>
<ul>
<li><p><span class="math inline">\(\beta_0\)</span> 是<code>basic_lm</code>模型（即不含样条或交互作用项）的 <span class="math inline">\(R^2\)</span> 均值的估计值；</p></li>
<li><p><span class="math inline">\(\beta_1\)</span> 表示当向<code>basic_lm</code>模型中引入交互作用时， <span class="math inline">\(R^2\)</span> 均值的变化量；</p></li>
<li><p><span class="math inline">\(\beta_2\)</span> 则是<code>basic_lm</code>模型与随机森林模型之间 <span class="math inline">\(R^2\)</span> 均值的变化量；</p></li>
<li><p><span class="math inline">\(\beta_3\)</span> 描述的是<code>basic_lm</code>模型与同时包含交互作用和样条函数的模型相比，<span class="math inline">\(R^2\)</span> 均值的变化量。</p></li>
</ul>
<p>根据这些模型参数，我们生成假设检验和p值，以对模型进行统计比较；但同时，我们必须解决重采样间效应的问题。过去，研究者通常将这些重复抽样的组别视为区块效应，并在模型中加入相应的项。另一种方法是将重采样效应视为随机效应，即认为这些特定的样本是从更大的潜在样本总体中随机抽取的。然而，实际上我们并不真正关注这些效应——我们只是希望在模型中加以调整，从而确保能够准确估计出那些真正感兴趣的差异的方差。</p>
<p>将重抽样间的效应视为随机效应，在理论上颇具吸引力。用于拟合具有此类随机效应的方差分析模型的方法，包括线性混合模型（Faraway, 2016）或和叶斯层次模型（如下一节所示）。</p>
<p>一种简单快捷的两模型比较方法，是将两个模型的<span class="math inline">\(R^2\)</span>值之差作为ANOVA模型中的响应数据。由于这些响应数据通过重采样进行匹配，因此差异中不包含重采样间的效应，正因如此，标准的ANOVA模型完全适用。例如，以下对<code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>函数的调用正是用于检验两个线性回归模型之间的差异：</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">compare_lm</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">rsq_wider</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>difference <span class="op">=</span> <span class="va">splines_lm</span> <span class="op">-</span> <span class="va">basic_lm</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">difference</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">compare_lm</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tidy</span><span class="op">(</span>conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">estimate</span>, <span class="va">p.value</span>, <span class="fu">starts_with</span><span class="op">(</span><span class="st">"conf"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 4</span></span>
<span><span class="co">#&gt;   estimate p.value conf.low conf.high</span></span>
<span><span class="co">#&gt;      &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  0.00730   0.130 -0.00262    0.0172</span></span>
<span></span>
<span><span class="co"># Alternatively, a paired t-test could also be used:</span></span>
<span><span class="va">rsq_wider</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">splines_lm</span>, <span class="va">basic_lm</span>, paired <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">estimate</span>, <span class="va">p.value</span>, <span class="fu">starts_with</span><span class="op">(</span><span class="st">"conf"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 4</span></span>
<span><span class="co">#&gt;   estimate p.value conf.low conf.high</span></span>
<span><span class="co">#&gt;      &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  0.00730   0.130 -0.00262    0.0172</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>我们可以用这种方式评估每一对的差异。需要注意的是，p值表明存在统计学上显著的信号；经由样条函数构建的经度和纬度项确实似乎产生了影响。然而，<span class="math inline">\(R^2\)</span>的差异仅估计为0.91%。如果我们的实际效应大小为2%，那么可能就不会认为这些项值得纳入模型中了。</p>
<p>我们之前已简要提及过p值，但究竟什么是p值呢？根据 Wasserstein 和 Lazar（2016年）的解释：非正式地说，p值是在特定统计模型下，数据的统计量（例如，两组比较时样本均值的差异）等于或超过其观测值的概率。换句话说，如果在“无差异”的零假设下重复进行这种分析多次，p值将反映我们所观察到的结果究竟有多极端。</p>
</section><section id="bayesian-methods" class="level2"><h2 class="anchored" data-anchor-id="bayesian-methods">Bayesian Methods</h2>
<p>我们刚刚通过假设检验来比较模型，但也可以采用更通用的方法，利用随机效应和贝叶斯统计来进行比较（McElreath 2020）。尽管这种方法比方差分析更为复杂，但其解释却比p值法更加简单明了。</p>
<p>此前的方差分析模型中，残差 <span class="math inline">\(\epsilon_{ij}\)</span> 被假定为相互独立，并服从均值为0、标准差恒定为 <span class="math inline">\(\sigma\)</span> 的正态分布。基于这一假设，统计理论表明，所估计的回归参数也遵循多变量正态分布，进而可据此计算出p值和置信区间。</p>
<p><span class="math display">\[
y_{ij} = \beta_0 + \beta_1x_{i1} + \beta_2x_{i2} + \beta_3x_{i3} + \epsilon_{ij}
\]</span></p>
<p>贝叶斯线性模型做出了额外的假设。除了为残差指定分布外，我们还需要为模型参数（<span class="math inline">\(\beta_j\)</span> 和 <span class="math inline">\(\sigma\)</span>）设定先验分布。这些分布是模型在接触观测数据之前所假定的参数分布。例如，上述模型的一组简单先验分布可能是：</p>
<p><span class="math display">\[
\begin{align}
\epsilon_{ij} &amp;\sim N(0, \sigma) \notag \\
\beta_j &amp;\sim N(0, 10) \notag \\
\sigma &amp;\sim \text{exponential}(1) \notag
\end{align}
\]</span></p>
<p>这些先验分布设定了模型参数的可能范围或合理范围，且不包含任何未知参数。例如，关于 <span class="math inline">\(\sigma\)</span> 的先验表明，其取值必须大于零，呈现明显的右偏分布，并且通常小于3或4。</p>
<p>请注意，回归参数的先验分布相当宽泛，标准差为10。在许多情况下，我们对这一先验可能并没有强烈的看法，只需确保其呈对称且钟形即可。较大的标准差意味着这是一个信息量较少的先验——它并未对参数可能取值范围施加过于严格的限制，从而让数据在参数估计过程中发挥更大的影响力。</p>
<p>根据观测数据和先验分布的设定，模型参数便可被估计出来。这些参数的最终分布（后验分布）是先验分布与似然估计的组合，完整地体现了模型对参数的概率描述，正是我们所关注的关键分布。</p>
<section id="a-random-intercept-model" class="level3"><h3 class="anchored" data-anchor-id="a-random-intercept-model">A random intercept model</h3>
<p>为了使我们的贝叶斯方差分析模型能够充分模拟重采样过程，我们考虑采用<strong>随机截距模型（random intercept model）</strong>。在此模型中，我们假设重采样仅通过改变截距来影响模型。需要注意的是，这一假设限制了重采样对回归参数<span class="math inline">\(\beta_j\)</span>的影响存在差异——即假定这些参数在不同重采样之间保持相同的关系。该模型的方程如下：</p>
<p><span class="math display">\[
y_{ij} = (\beta_0 + b_{i}) + \beta_1x_{i1} + \beta_2x_{i2} + \beta_3x_{i3} + \epsilon_{ij}
\]</span></p>
<p>这对于重新抽样的统计方法来说并非是不合理的模型，当这些方法如 <a href="#fig-11.2" class="quarto-xref">Figure&nbsp;2</a> 所示在不同模型间绘制时，往往表现出较为平行的效果（即各条线几乎不会交叉）。</p>
<p>对于这种模型配置，我们对随机效应的先验分布做出了一个额外假设。合理的假设是采用另一种对称分布，例如另一条钟形曲线。鉴于我们的汇总统计数据显示有效样本量仅为10，我们将选择一个比标准正态分布更宽的先验分布。具体来说，我们将使用自由度为1的t分布（即 <span class="math inline">\(b_i \sim t(1)\)</span>），其尾部比相应的高斯分布更为厚重。</p>
<p><strong>tidyposterior</strong>包提供了用于拟合此类贝叶斯模型的函数，以便比较重新采样的模型。其中，主函数名为<code><a href="https://tidyposterior.tidymodels.org/reference/perf_mod.html">perf_mod()</a></code>，它被设计为能“无缝兼容”不同类型的对象：</p>
<ul>
<li><p>对于工作流集合<code>workflwo_set</code>，它会创建一个ANOVA模型，其中各组对应于不同的工作流。我们现有的模型并未优化任何调参参数（详见接下来的三章）。如果集合中的某个工作流包含调参数据，则在贝叶斯分析中将采用该工作流的最佳调参设置。换句话说，尽管存在调参参数，<code><a href="https://tidyposterior.tidymodels.org/reference/perf_mod.html">perf_mod()</a></code>的重点仍在于进行工作流间的比较。</p></li>
<li><p>对于包含单个经重采样调优的模型的对象<code>tune_results</code>，<code><a href="https://tidyposterior.tidymodels.org/reference/perf_mod.html">perf_mod()</a></code>会进行模型内部的比较。在这种情况下，贝叶斯 ANOVA 模型中所检验的分组变量正是由调参参数定义的子模型。</p></li>
<li><p><code><a href="https://tidyposterior.tidymodels.org/reference/perf_mod.html">perf_mod()</a></code> 函数还可以接受由<code>rsample</code>生成的数据框，该数据框包含与两个或多个模型/工作流结果相关的性能指标列。这些指标可能是通过非标准方式生成的。</p></li>
</ul>
<p>从这些类型的对象中，<code><a href="https://tidyposterior.tidymodels.org/reference/perf_mod.html">perf_mod()</a></code>函数会确定一个合适的贝叶斯模型，并利用重采样统计量对其进行拟合。在我们的示例中，它将对与工作流相关的四组 <span class="math inline">\(R^2\)</span> 统计量进行建模。</p>
<p><strong>tidyposterior</strong> 包通过<strong>rstanarm</strong>包调用“Stan software”指定并拟合模型。rstanarm包中的函数具有默认先验分布（详细信息请参阅 <code><a href="https://mc-stan.org/rstanarm/reference/priors.html">?rstanarm::priors</a></code>）。以下模型对所有参数均采用默认先验，但随机截距除外——它遵循“t-分布”。由于估计过程涉及随机数生成，因此在函数调用中设置了随机种子。估计过程采用迭代方式，并在称为“链”的多个集合中重复进行多次。<code>iter</code>参数用于指定每个链中估计过程的迭代次数。当使用多条链时，其结果将被合并（前提是已通过诊断评估验证）。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyposterior.tidymodels.org">tidyposterior</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstanarm/">rstanarm</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: Rcpp</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'Rcpp'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:rsample':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     populate</span></span>
<span><span class="co">#&gt; This is rstanarm version 2.32.2</span></span>
<span><span class="co">#&gt; - See https://mc-stan.org/rstanarm/articles/priors for changes to default priors!</span></span>
<span><span class="co">#&gt; - Default priors may change, so it's safest to specify priors, even if equivalent to the defaults.</span></span>
<span><span class="co">#&gt; - For execution on a local, multicore CPU with excess RAM we recommend calling</span></span>
<span><span class="co">#&gt;   options(mc.cores = parallel::detectCores())</span></span>
<span></span>
<span><span class="co"># The rstanarm package creates copious amounts of output; those results</span></span>
<span><span class="co"># are not shown here but are worth inspecting for potential issues. The</span></span>
<span><span class="co"># option `refresh = 0` can be used to eliminate the logging.</span></span>
<span><span class="va">rsq_anova</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://tidyposterior.tidymodels.org/reference/perf_mod.html">perf_mod</a></span><span class="op">(</span></span>
<span>    <span class="va">four_models</span>,</span>
<span>    metric <span class="op">=</span> <span class="st">"rsq"</span>,</span>
<span>    prior_intercept <span class="op">=</span> <span class="fu">rstanarm</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstanarm/reference/priors.html">student_t</a></span><span class="op">(</span>df <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    chains <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    iter <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">1102</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'continuous' NOW (CHAIN 1).</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Gradient evaluation took 6.4e-05 seconds</span></span>
<span><span class="co">#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.64 seconds.</span></span>
<span><span class="co">#&gt; Chain 1: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Iteration:    1 / 5000 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  500 / 5000 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1000 / 5000 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1500 / 5000 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 2000 / 5000 [ 40%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 2500 / 5000 [ 50%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 2501 / 5000 [ 50%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 3000 / 5000 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 3500 / 5000 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 4000 / 5000 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 4500 / 5000 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 5000 / 5000 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1:  Elapsed Time: 3.815 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 1:                2.254 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1:                6.069 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'continuous' NOW (CHAIN 2).</span></span>
<span><span class="co">#&gt; Chain 2: </span></span>
<span><span class="co">#&gt; Chain 2: Gradient evaluation took 2.4e-05 seconds</span></span>
<span><span class="co">#&gt; Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.24 seconds.</span></span>
<span><span class="co">#&gt; Chain 2: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 2: </span></span>
<span><span class="co">#&gt; Chain 2: </span></span>
<span><span class="co">#&gt; Chain 2: Iteration:    1 / 5000 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration:  500 / 5000 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 1000 / 5000 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 1500 / 5000 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 2000 / 5000 [ 40%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 2500 / 5000 [ 50%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 2501 / 5000 [ 50%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 3000 / 5000 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 3500 / 5000 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 4000 / 5000 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 4500 / 5000 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 5000 / 5000 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: </span></span>
<span><span class="co">#&gt; Chain 2:  Elapsed Time: 3.258 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 2:                2.484 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2:                5.742 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 2: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'continuous' NOW (CHAIN 3).</span></span>
<span><span class="co">#&gt; Chain 3: </span></span>
<span><span class="co">#&gt; Chain 3: Gradient evaluation took 2.3e-05 seconds</span></span>
<span><span class="co">#&gt; Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 0.23 seconds.</span></span>
<span><span class="co">#&gt; Chain 3: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 3: </span></span>
<span><span class="co">#&gt; Chain 3: </span></span>
<span><span class="co">#&gt; Chain 3: Iteration:    1 / 5000 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration:  500 / 5000 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 1000 / 5000 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 1500 / 5000 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 2000 / 5000 [ 40%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 2500 / 5000 [ 50%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 2501 / 5000 [ 50%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 3000 / 5000 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 3500 / 5000 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 4000 / 5000 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 4500 / 5000 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 5000 / 5000 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3: </span></span>
<span><span class="co">#&gt; Chain 3:  Elapsed Time: 3.956 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 3:                2.204 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3:                6.16 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 3: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'continuous' NOW (CHAIN 4).</span></span>
<span><span class="co">#&gt; Chain 4: </span></span>
<span><span class="co">#&gt; Chain 4: Gradient evaluation took 6e-05 seconds</span></span>
<span><span class="co">#&gt; Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 0.6 seconds.</span></span>
<span><span class="co">#&gt; Chain 4: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 4: </span></span>
<span><span class="co">#&gt; Chain 4: </span></span>
<span><span class="co">#&gt; Chain 4: Iteration:    1 / 5000 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration:  500 / 5000 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 1000 / 5000 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 1500 / 5000 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 2000 / 5000 [ 40%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 2500 / 5000 [ 50%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 2501 / 5000 [ 50%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 3000 / 5000 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 3500 / 5000 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 4000 / 5000 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 4500 / 5000 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 5000 / 5000 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4: </span></span>
<span><span class="co">#&gt; Chain 4:  Elapsed Time: 3.546 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 4:                1.945 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4:                5.491 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 4:</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>生成的对象包含重采样过程的信息，同时还嵌入了Stan对象（存储在一个名为stan的元素中）。我们最感兴趣的是回归参数的后验分布。tidyposterior包提供了一个<code><a href="https://generics.r-lib.org/reference/tidy.html">tidy()</a></code>方法，可将这些后验分布提取到一个tibble中：</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_post</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">rsq_anova</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># Take a random sample from the posterior distribution</span></span>
<span>  <span class="co"># so set the seed again to be reproducible.</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="fl">1103</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">model_post</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 40,000</span></span>
<span><span class="co">#&gt; Columns: 2</span></span>
<span><span class="co">#&gt; $ model     &lt;chr&gt; "random_forest", "basic_lm", "interact_lm", "splines_lm",…</span></span>
<span><span class="co">#&gt; $ posterior &lt;dbl&gt; 0.8317200, 0.7925903, 0.7946385, 0.7987719, 0.8412325, 0.…</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>四个后验分布如 <a href="#fig-11.3" class="quarto-xref">Figure&nbsp;3</a> 所示。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_post</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>model <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_inorder</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">posterior</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">50</span>, color <span class="op">=</span> <span class="st">"white"</span>, fill <span class="op">=</span> <span class="st">"blue"</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">model</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-11.3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-11.3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="11-Comparing-Models-with-Resampling_files/figure-html/fig-11.3-1.png" class="img-fluid figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-11.3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Posterior distributions for the coefficient of determination using four different models
</figcaption></figure>
</div>
</div>
</div>
<p>这些直方图描述了每个模型中均值<span class="math inline">\(R^2\)</span>值的估计概率分布。其中存在一定重叠，尤其是在三个线性模型之间。</p>
<p>此外，模型结果还提供了一个基本的<code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code>方法，如 <a href="#fig-11.4" class="quarto-xref">Figure&nbsp;4</a> 所示，以及经过整理后的对象，其中叠加展示了密度图。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">rsq_anova</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">workflow</span><span class="op">)</span>, nudge_x <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">8</span>, nudge_y <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-11.4" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-11.4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="11-Comparing-Models-with-Resampling_files/figure-html/fig-11.4-1.png" class="img-fluid figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-11.4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Credible intervals derived from the model posterior distributions
</figcaption></figure>
</div>
</div>
</div>
<p>使用贝叶斯模型进行重采样的一大优势在于，一旦我们获得了参数的后验分布，便能轻松得到这些参数组合的后验分布。例如，若要比较两个线性回归模型，我们关注的是两者的均值差异。计算这一差异的后验分布时，只需分别从每个模型的后验中独立采样，并取其差值即可。<code><a href="https://tidyposterior.tidymodels.org/reference/contrast_models.html">contrast_models()</a></code>函数便可完成这一任务。要指定需要进行的比较，<code>list_1</code>和<code>list_2</code>参数需接收字符型向量，并计算这两个列表中模型之间的差异（具体表达为<code>list_1 - list_2</code>）。</p>
<p>我们可以比较两个线性模型，并将结果可视化于 <a href="#fig-11.5" class="quarto-xref">Figure&nbsp;5</a> 中。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rqs_diff</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://tidyposterior.tidymodels.org/reference/contrast_models.html">contrast_models</a></span><span class="op">(</span><span class="va">rsq_anova</span>,</span>
<span>    list_1 <span class="op">=</span> <span class="st">"splines_lm"</span>,</span>
<span>    list_2 <span class="op">=</span> <span class="st">"basic_lm"</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">1104</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">rqs_diff</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">difference</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">50</span>, color <span class="op">=</span> <span class="st">"white"</span>, fill <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-11.5" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-11.5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="11-Comparing-Models-with-Resampling_files/figure-html/fig-11.5-1.png" class="img-fluid figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-11.5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Posterior distribution for the difference in the coefficient of determination
</figcaption></figure>
</div>
</div>
</div>
<p>后验结果显示，分布的中心大于零（表明使用样条函数的模型通常具有较大值），但同时也与零存在一定程度的重叠。该对象的<code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code>方法不仅计算了分布的均值，还生成了可信区间——这是贝叶斯方法中对应于传统置信区间的概念。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">rqs_diff</span>, size <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">contrast</span>, <span class="fu">starts_with</span><span class="op">(</span><span class="st">"pract"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 4</span></span>
<span><span class="co">#&gt;   contrast               pract_neg pract_equiv pract_pos</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                      &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 splines_lm vs basic_lm         0        1.00    0.0002</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code>probability</code>列反映了后验分布中大于零的比例。这正是正差异真实存在的概率。该数值并不接近零，有力地表明了统计显著性——即从统计学角度来看，实际差异确实不为零。</p>
<p>然而，均值差的估计值非常接近零。回想一下，我们之前建议的实际效应大小为2%。借助后验分布，我们还可以计算出达到实际显著性的概率。在贝叶斯分析中，这被称为ROPE估计（即“实际等效区域”，Kruschke和Liddell，2018年）。要估算这一概率，可使用<code>summary</code>函数中的<code>size</code>选项：</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">rqs_diff</span>, size <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">contrast</span>, <span class="fu">starts_with</span><span class="op">(</span><span class="st">"pract"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 4</span></span>
<span><span class="co">#&gt;   contrast               pract_neg pract_equiv pract_pos</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                      &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 splines_lm vs basic_lm         0        1.00    0.0002</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code>pract_equiv</code>列表示后验分布中位于<code>[-size, size]</code>区间内的比例（而<code>pract_neg</code>和<code>pract_pos</code>列则分别表示低于和高于该区间的比例）。这一较大数值表明，对于我们的效应大小而言，两个模型在实际意义上几乎完全相同的可能性极高。尽管之前的图表显示，我们观察到的差异很可能不为零，但等效性检验却提示，这种差异小到不足以在实际应用中产生意义。</p>
<p>同样的流程也可用于将随机森林模型与经过重采样的一个或两个线性回归模型进行比较。实际上，当<code><a href="https://tidyposterior.tidymodels.org/reference/perf_mod.html">perf_mod()</a></code>函数与工作流集合一起使用时，<code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code>方法能够展示实际等效性结果，直观地对比每个工作流与当前最佳模型（在本例中即随机森林模型）。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">rsq_anova</span>, type <span class="op">=</span> <span class="st">"ROPE"</span>, size <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">workflow</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-11.6" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-11.6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="11-Comparing-Models-with-Resampling_files/figure-html/fig-11.6-1.png" class="img-fluid figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-11.6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Probability of practical equivalence for an effect size of 2%
</figcaption></figure>
</div>
</div>
</div>
<p><a href="#fig-11.6" class="quarto-xref">Figure&nbsp;6</a> 表明，在采用2%的实际效应大小时，没有任何一个线性模型能与随机森林模型相媲美。</p>
</section><section id="the-effect-of-the-amount-of-resampling" class="level3"><h3 class="anchored" data-anchor-id="the-effect-of-the-amount-of-resampling">The effect of the amount of resampling</h3>
<p>这些类型的正式贝叶斯比较中，重抽样的次数有何影响？更多的重抽样会提高整体重抽样估计的精度；而这种精度又会进一步传递到此类分析中。为了说明这一点，我们采用了重复交叉验证的方法增加了重抽样的次数。那么，后验分布发生了怎样的变化呢？ <a href="#fig-11.7" class="quarto-xref">Figure&nbsp;7</a> 展示了在最多进行100次重抽样（由10次10折交叉验证的重复生成）情况下的90%可信区间。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 源数据见 https://github.com/tidymodels/TMwR/blob/main/RData/post_intervals.RData</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"Rdata/post_intervals.RData"</span><span class="op">)</span></span>
<span><span class="va">y_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">Mean</span> <span class="op">~</span> <span class="va">difference</span> <span class="op">~</span> <span class="st">"in"</span> <span class="op">~</span> <span class="fu">italic</span><span class="op">(</span><span class="va">R</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">intervals</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">resamples</span>, y <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="va">y_lab</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Number of Resamples (repeated 10-fold cross-validation)"</span></span>
<span>  <span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-11.7" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-11.7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="11-Comparing-Models-with-Resampling_files/figure-html/fig-11.7-1.png" class="img-fluid figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-11.7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Probability of practical equivalence to the random forest model
</figcaption></figure>
</div>
</div>
</div>
<p>随着重抽样的次数增加，区间宽度逐渐缩小。显然，从10次重抽样增至30次的效果，比从80次增加到100次更为显著。然而，使用“大量”重抽样所带来的收益正在递减——当然，“大量”的定义会因具体数据集而有所不同。</p>
</section></section><section id="chapter-summary" class="level2"><h2 class="anchored" data-anchor-id="chapter-summary">Chapter Summary</h2>
<p>本章介绍了用于检验模型间性能差异的正式统计方法。我们展示了重采样内部效应——即同一重采样的结果往往较为相似；这一重采样汇总统计量的特点，需要进行恰当的分析，才能确保模型比较的有效性。此外，尽管统计显著性和实际意义都是模型比较中至关重要的概念，但二者并不相同。</p>


</section><a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><script src="https://utteranc.es/client.js" repo="hanguojun007/Blog" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../../Books/Tidy Modeling with R/10 Resampling for Evaluating Performance.html" class="pagination-link" aria-label="10 Resampling for Evaluating Performance">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">10 Resampling for Evaluating Performance</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../Books/Tidy Modeling with R/12 Model Tuning and the Dangers of Overfitting.html" class="pagination-link" aria-label="12 Model Tuning and the Dangers of Overfitting">
        <span class="nav-page-text">12 Model Tuning and the Dangers of Overfitting</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>